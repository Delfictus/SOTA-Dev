â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘     PRISM4D NHS RT-FULL - BATCH MODE (from manifest)          â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

[2026-02-05T20:17:26Z INFO  nhs_rt_full] Loading manifest: e2e_validation_test/batch_manifest_final.json
[2026-02-05T20:17:26Z INFO  nhs_rt_full] Manifest loaded: 10 structures in 3 batches
[2026-02-05T20:17:26Z INFO  nhs_rt_full] Launching 3 batches in parallel on shared GPU...
[2026-02-05T20:17:26Z INFO  nhs_rt_full] â•â•â• Batch 0 (Small tier, 4 structures, 15 replicas) â•â•â•
[2026-02-05T20:17:26Z INFO  nhs_rt_full]   GPU-concurrent execution: 4 structures Ã— 15 replicas = 60 total in AmberSimdBatch
[2026-02-05T20:17:26Z INFO  nhs_rt_full] Waiting for all 3 batches to complete...
[2026-02-05T20:17:26Z INFO  nhs_rt_full] â•â•â• Batch 1 (Small tier, 4 structures, 15 replicas) â•â•â•
[2026-02-05T20:17:26Z INFO  nhs_rt_full]     Creating AmberSimdBatch: 4 structures Ã— 15 replicas = 60 total entries, max 13294 atoms
[2026-02-05T20:17:26Z INFO  nhs_rt_full]   GPU-concurrent execution: 4 structures Ã— 15 replicas = 60 total in AmberSimdBatch
[2026-02-05T20:17:26Z INFO  nhs_rt_full]     Creating AmberSimdBatch: 4 structures Ã— 15 replicas = 60 total entries, max 22878 atoms
[2026-02-05T20:17:26Z INFO  nhs_rt_full] â•â•â• Batch 2 (Small tier, 2 structures, 15 replicas) â•â•â•
[2026-02-05T20:17:26Z INFO  nhs_rt_full]   GPU-concurrent execution: 2 structures Ã— 15 replicas = 30 total in AmberSimdBatch
[2026-02-05T20:17:26Z INFO  nhs_rt_full]     Creating AmberSimdBatch: 2 structures Ã— 15 replicas = 30 total entries, max 20148 atoms
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] AmberSimdBatch initialized: max 30 structures Ã— 20148 atoms
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loading PRISM-PREP topology from: e2e_validation_test/prep/1igt.topology.json
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] AmberSimdBatch initialized: max 60 structures Ã— 13294 atoms
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loading PRISM-PREP topology from: e2e_validation_test/prep/1ade.topology.json
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] AmberSimdBatch initialized: max 60 structures Ã— 22878 atoms
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loading PRISM-PREP topology from: e2e_validation_test/prep/1btl.topology.json
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loaded topology: 4073 atoms, 263 residues, 1 chains
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       Loaded: 1btl_sanitized (4073 atoms, 281 aromatics) â†’ 15 replicas starting at ID 0
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loaded topology: 13294 atoms, 862 residues, 2 chains
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loading PRISM-PREP topology from: e2e_validation_test/prep/1a4q.topology.json
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loaded topology: 20148 atoms, 1316 residues, 4 chains
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       Loaded: 1ade_sanitized (13294 atoms, 1344 aromatics) â†’ 15 replicas starting at ID 0
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       Loaded: 1igt_sanitized (20148 atoms, 2686 aromatics) â†’ 15 replicas starting at ID 0
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loaded topology: 11926 atoms, 780 residues, 2 chains
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       Loaded: 1a4q_sanitized (11926 atoms, 1578 aromatics) â†’ 15 replicas starting at ID 15
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loading PRISM-PREP topology from: e2e_validation_test/prep/1ere.topology.json
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loading PRISM-PREP topology from: e2e_validation_test/prep/1bj4.topology.json
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loaded topology: 7261 atoms, 470 residues, 1 chains
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       Loaded: 1bj4_sanitized (7261 atoms, 767 aromatics) â†’ 15 replicas starting at ID 15
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loaded topology: 22878 atoms, 1410 residues, 6 chains
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loading PRISM-PREP topology from: e2e_validation_test/prep/1crn.topology.json
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loaded topology: 642 atoms, 46 residues, 1 chains
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       Loaded: 1crn_sanitized (642 atoms, 62 aromatics) â†’ 15 replicas starting at ID 15
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       Loaded: combined_chains (22878 atoms, 1776 aromatics) â†’ 15 replicas starting at ID 30
[2026-02-05T20:17:26Z INFO  nhs_rt_full]     Finalizing batch for GPU upload...
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loading PRISM-PREP topology from: e2e_validation_test/prep/1hhp.topology.json
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loaded topology: 1564 atoms, 99 residues, 1 chains
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       Loaded: 1hhp_sanitized (1564 atoms, 110 aromatics) â†’ 15 replicas starting at ID 30
[2026-02-05T20:17:26Z INFO  prism_gpu::h_constraints] ğŸ”— HConstraints: 100860 clusters (60135 single, 28575 CH2/NH2, 12150 CH3/NH3)
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] H-constraints: 100860 clusters (153735 total constraints, DOF adjusted)
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loading PRISM-PREP topology from: e2e_validation_test/prep/1qmf.topology.json
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] Initializing FP16 parameter buffers...
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch]   FP16 buffers: 311850 atoms (609 KB saved)
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] Initializing Verlet neighbor list...
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch]   Verlet list: 311850 atoms, skin=2.0Ã…, rebuild threshold=1.0Ã…
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] Initializing Tensor Core force calculator...
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch]   Tensor Cores: enabled (WMMA 16Ã—16 tiles)
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] Initializing async MD pipeline...
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch]   Async pipeline: enabled (bonded/non-bonded overlap)
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] SOTA optimizations enabled:
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch]   - Verlet list: YES
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch]   - Tensor Cores: YES
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch]   - FP16 params: YES
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch]   - Async pipeline: YES
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch]   - Batched forces: YES
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] Batch finalized: 30 structures, 311850 atoms
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       âœ“ Batch ready: 30 total entries (2 structures Ã— 15 replicas) on GPU
[2026-02-05T20:17:26Z INFO  nhs_rt_full]     Running 50000 steps per replica (batch executes in lockstep)...
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       Protocol phases: cold=20000, ramp=8000, warm=22000
[2026-02-05T20:17:26Z INFO  nhs_rt_full]     [1/3] Cold hold at 50K (20000 steps)...
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] SIMD batch MD: 30 structures, 311850 atoms, 500 steps
[2026-02-05T20:17:26Z INFO  prism_gpu::amber_simd_batch] Using SOTA path with Verlet neighbor lists
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loaded topology: 8460 atoms, 559 residues, 1 chains
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       Loaded: 1qmf_sanitized (8460 atoms, 877 aromatics) â†’ 15 replicas starting at ID 45
[2026-02-05T20:17:26Z INFO  nhs_rt_full]     Finalizing batch for GPU upload...
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loading PRISM-PREP topology from: e2e_validation_test/prep/1g1f.topology.json
[2026-02-05T20:17:26Z INFO  prism_nhs::input] Loaded topology: 4878 atoms, 301 residues, 2 chains
[2026-02-05T20:17:26Z INFO  nhs_rt_full]       Loaded: 1g1f_sanitized (4878 atoms, 613 aromatics) â†’ 15 replicas starting at ID 45
[2026-02-05T20:17:26Z INFO  nhs_rt_full]     Finalizing batch for GPU upload...
[2026-02-05T20:17:27Z INFO  prism_gpu::h_constraints] ğŸ”— HConstraints: 209250 clusters (118770 single, 61275 CH2/NH2, 29205 CH3/NH3)
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] H-constraints: 209250 clusters (328935 total constraints, DOF adjusted)
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Initializing FP16 parameter buffers...
[2026-02-05T20:17:27Z INFO  prism_gpu::h_constraints] ğŸ”— HConstraints: 145830 clusters (82800 single, 42645 CH2/NH2, 20385 CH3/NH3)
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   FP16 buffers: 656325 atoms (1281 KB saved)
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Initializing Verlet neighbor list...
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] H-constraints: 145830 clusters (229245 total constraints, DOF adjusted)
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Initializing FP16 parameter buffers...
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   FP16 buffers: 458685 atoms (895 KB saved)
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Initializing Verlet neighbor list...
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   Verlet list: 656325 atoms, skin=2.0Ã…, rebuild threshold=1.0Ã…
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Initializing Tensor Core force calculator...
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   Tensor Cores: enabled (WMMA 16Ã—16 tiles)
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Initializing async MD pipeline...
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   Async pipeline: enabled (bonded/non-bonded overlap)
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] SOTA optimizations enabled:
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   - Verlet list: YES
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   - Tensor Cores: YES
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   - FP16 params: YES
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   - Async pipeline: YES
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   - Batched forces: YES
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Batch finalized: 60 structures, 656325 atoms
[2026-02-05T20:17:27Z INFO  nhs_rt_full]       âœ“ Batch ready: 60 total entries (4 structures Ã— 15 replicas) on GPU
[2026-02-05T20:17:27Z INFO  nhs_rt_full]     Running 50000 steps per replica (batch executes in lockstep)...
[2026-02-05T20:17:27Z INFO  nhs_rt_full]       Protocol phases: cold=20000, ramp=8000, warm=22000
[2026-02-05T20:17:27Z INFO  nhs_rt_full]     [1/3] Cold hold at 50K (20000 steps)...
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] SIMD batch MD: 60 structures, 656325 atoms, 500 steps
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Using SOTA path with Verlet neighbor lists
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   Verlet list: 458685 atoms, skin=2.0Ã…, rebuild threshold=1.0Ã…
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Initializing Tensor Core force calculator...
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   Tensor Cores: enabled (WMMA 16Ã—16 tiles)
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Initializing async MD pipeline...
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   Async pipeline: enabled (bonded/non-bonded overlap)
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] SOTA optimizations enabled:
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   - Verlet list: YES
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   - Tensor Cores: YES
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   - FP16 params: YES
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   - Async pipeline: YES
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch]   - Batched forces: YES
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Batch finalized: 60 structures, 458685 atoms
[2026-02-05T20:17:27Z INFO  nhs_rt_full]       âœ“ Batch ready: 60 total entries (4 structures Ã— 15 replicas) on GPU
[2026-02-05T20:17:27Z INFO  nhs_rt_full]     Running 50000 steps per replica (batch executes in lockstep)...
[2026-02-05T20:17:27Z INFO  nhs_rt_full]       Protocol phases: cold=20000, ramp=8000, warm=22000
[2026-02-05T20:17:27Z INFO  nhs_rt_full]     [1/3] Cold hold at 50K (20000 steps)...
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] SIMD batch MD: 60 structures, 458685 atoms, 500 steps
[2026-02-05T20:17:27Z INFO  prism_gpu::amber_simd_batch] Using SOTA path with Verlet neighbor lists
[2026-02-05T20:23:46Z INFO  prism_gpu::amber_simd_batch] SOTA MD complete: 500 steps, 3 Verlet rebuilds (avg 166.7 steps/rebuild)
[2026-02-05T20:23:46Z INFO  prism_gpu::amber_simd_batch] SIMD batch MD complete: 500 steps

thread '<unnamed>' (1259406) panicked at /home/diddy/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/cudarc-0.18.2/src/driver/safe/core.rs:1368:9:
assertion failed: dst.len() >= src.len()
note: run with `RUST_BACKTRACE=1` environment variable to display a backtrace
[2026-02-05T20:23:50Z INFO  prism_gpu::amber_simd_batch] SOTA MD complete: 500 steps, 3 Verlet rebuilds (avg 166.7 steps/rebuild)
[2026-02-05T20:23:50Z INFO  prism_gpu::amber_simd_batch] SIMD batch MD complete: 500 steps

thread '<unnamed>' (1259405) panicked at /home/diddy/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/cudarc-0.18.2/src/driver/safe/core.rs:1368:9:
assertion failed: dst.len() >= src.len()
[2026-02-05T20:23:51Z INFO  prism_gpu::amber_simd_batch] SOTA MD complete: 500 steps, 3 Verlet rebuilds (avg 166.7 steps/rebuild)
[2026-02-05T20:23:51Z INFO  prism_gpu::amber_simd_batch] SIMD batch MD complete: 500 steps

thread '<unnamed>' (1259404) panicked at /home/diddy/.cargo/registry/src/index.crates.io-1949cf8c6b5b557f/cudarc-0.18.2/src/driver/safe/core.rs:1368:9:
assertion failed: dst.len() >= src.len()

thread 'main' (1259402) panicked at crates/prism-nhs/src/bin/nhs_rt_full.rs:291:23:
called `Result::unwrap()` on an `Err` value: Any { .. }
